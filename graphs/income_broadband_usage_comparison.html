<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income vs Broadband Usage: Richest vs Poorest Counties</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        #chart {
            width: 100%;
            height: 700px;
            margin-bottom: 30px;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
        }
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }
        .comparison-table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table thead {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        .comparison-table tr:hover {
            background: #f5f5f5;
        }
        .richest {
            background-color: #e3f2fd;
        }
        .poorest {
            background-color: #fff3e0;
        }
        .usage-high {
            color: #2e7d32;
            font-weight: bold;
        }
        .usage-low {
            color: #c62828;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Income vs Broadband Usage Analysis</h1>
        <p class="subtitle">Comparing Top 5 Richest Counties vs Top 5 Poorest Counties (2020)</p>
        
        <div id="chart"></div>
        
        <div class="stats-container">
            <div class="stat-card">
                <h3>Avg Income - Richest 5</h3>
                <div class="value" id="avgRichest">-</div>
            </div>
            <div class="stat-card">
                <h3>Avg Income - Poorest 5</h3>
                <div class="value" id="avgPoorest">-</div>
            </div>
            <div class="stat-card">
                <h3>Avg Usage - Richest 5</h3>
                <div class="value" id="avgUsageRichest">-</div>
            </div>
            <div class="stat-card">
                <h3>Avg Usage - Poorest 5</h3>
                <div class="value" id="avgUsagePoorest">-</div>
            </div>
        </div>
        
        <h2 style="margin-top: 40px;">Detailed County Comparison</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>County Name</th>
                    <th>Median Income (2020)</th>
                    <th>Broadband Usage (2020)</th>
                    <th>Usage %</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        // Top 5 Richest Counties (by median income 2020)
        const richestCounties = [
            { name: "Loudoun County", income: 147111, usage: 0.883 },
            { name: "Falls Church city", income: 146922, usage: 1.0 },
            { name: "Fairfax County", income: 109708, usage: 0.884 }, // Using county value
            { name: "Arlington County", income: 122604, usage: 0.776 },
            { name: "Stafford County", income: 112247, usage: 0.885 }
        ];

        // Top 5 Poorest Counties (by median income 2020)
        const poorestCounties = [
            { name: "Emporia city", income: 30058, usage: null }, // No usage data available
            { name: "Dickenson County", income: 30116, usage: 0.257 },
            { name: "Norton city", income: 30518, usage: 0.409 },
            { name: "Buchanan County", income: 34302, usage: 0.234 },
            { name: "Radford city", income: 34576, usage: 0.203 }
        ];

        function formatCurrency(value) {
            return '$' + value.toLocaleString('en-US');
        }

        function formatPercent(value) {
            if (value === null || value === undefined) return 'N/A';
            return (value * 100).toFixed(1) + '%';
        }

        function calculateStats() {
            const avgRichest = richestCounties.reduce((sum, c) => sum + c.income, 0) / richestCounties.length;
            const avgPoorest = poorestCounties.reduce((sum, c) => sum + c.income, 0) / poorestCounties.length;
            
            const richestUsage = richestCounties.map(c => c.usage).filter(u => u !== null);
            const poorestUsage = poorestCounties.map(c => c.usage).filter(u => u !== null);
            
            const avgUsageRichest = richestUsage.reduce((sum, u) => sum + u, 0) / richestUsage.length;
            const avgUsagePoorest = poorestUsage.reduce((sum, u) => sum + u, 0) / poorestUsage.length;
            
            document.getElementById('avgRichest').textContent = formatCurrency(avgRichest);
            document.getElementById('avgPoorest').textContent = formatCurrency(avgPoorest);
            document.getElementById('avgUsageRichest').textContent = formatPercent(avgUsageRichest);
            document.getElementById('avgUsagePoorest').textContent = formatPercent(avgUsagePoorest);
        }

        function createChart() {
            // Filter out counties without usage data
            const richestData = richestCounties.filter(c => c.usage !== null);
            const poorestData = poorestCounties.filter(c => c.usage !== null);

            // Find income range for normalization
            const allIncomes = [...richestData.map(c => c.income), ...poorestData.map(c => c.income)];
            const minIncome = Math.min(...allIncomes);
            const maxIncome = Math.max(...allIncomes);
            const incomeRange = maxIncome - minIncome;

            // Normalize income to 0-100 scale for comparison
            const normalizeIncome = (income) => ((income - minIncome) / incomeRange) * 100;

            // Income bars for richest counties (normalized to 0-100)
            const trace1 = {
                x: richestData.map(c => c.name.replace(' County', '').replace(' city', '')),
                y: richestData.map(c => normalizeIncome(c.income)),
                name: 'Income - Richest (normalized)',
                type: 'bar',
                marker: {
                    color: 'rgba(33, 150, 243, 0.7)',
                    line: {
                        color: 'rgba(33, 150, 243, 1)',
                        width: 2
                    }
                },
                text: richestData.map(c => formatCurrency(c.income)),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>Income: %{text}<br>Usage: %{customdata}<extra></extra>',
                customdata: richestData.map(c => formatPercent(c.usage))
            };

            // Income bars for poorest counties (normalized to 0-100)
            const trace2 = {
                x: poorestData.map(c => c.name.replace(' County', '').replace(' city', '')),
                y: poorestData.map(c => normalizeIncome(c.income)),
                name: 'Income - Poorest (normalized)',
                type: 'bar',
                marker: {
                    color: 'rgba(255, 152, 0, 0.7)',
                    line: {
                        color: 'rgba(255, 152, 0, 1)',
                        width: 2
                    }
                },
                text: poorestData.map(c => formatCurrency(c.income)),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>Income: %{text}<br>Usage: %{customdata}<extra></extra>',
                customdata: poorestData.map(c => formatPercent(c.usage))
            };

            // Usage bars for richest counties (already 0-100 scale)
            const trace3 = {
                x: richestData.map(c => c.name.replace(' County', '').replace(' city', '')),
                y: richestData.map(c => c.usage * 100), // Convert 0-1 to 0-100
                name: 'Usage - Richest (%)',
                type: 'bar',
                marker: {
                    color: 'rgba(76, 175, 80, 0.7)',
                    line: {
                        color: 'rgba(76, 175, 80, 1)',
                        width: 2
                    }
                },
                text: richestData.map(c => formatPercent(c.usage)),
                textposition: 'inside',
                hovertemplate: '<b>%{x}</b><br>Usage: %{text}<extra></extra>'
            };

            // Usage bars for poorest counties (already 0-100 scale)
            const trace4 = {
                x: poorestData.map(c => c.name.replace(' County', '').replace(' city', '')),
                y: poorestData.map(c => c.usage * 100), // Convert 0-1 to 0-100
                name: 'Usage - Poorest (%)',
                type: 'bar',
                marker: {
                    color: 'rgba(244, 67, 54, 0.7)',
                    line: {
                        color: 'rgba(244, 67, 54, 1)',
                        width: 2
                    }
                },
                text: poorestData.map(c => formatPercent(c.usage)),
                textposition: 'inside',
                hovertemplate: '<b>%{x}</b><br>Usage: %{text}<extra></extra>'
            };

            const layout = {
                title: {
                    text: 'Income vs Broadband Usage: Richest vs Poorest Counties (2020)<br><sub>Both metrics normalized to 0-100 scale for comparison</sub>',
                    font: { size: 24 }
                },
                xaxis: {
                    title: 'County',
                    tickangle: -45,
                    tickfont: { size: 10 }
                },
                yaxis: {
                    title: 'Normalized Score (0-100)',
                    range: [0, 100],
                    tickformat: '.0f',
                    side: 'left'
                },
                barmode: 'group',
                hovermode: 'closest',
                legend: {
                    x: 0.5,
                    y: -0.3,
                    xanchor: 'center',
                    orientation: 'h'
                },
                margin: {
                    b: 150,
                    t: 120
                },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('chart', [trace1, trace2, trace3, trace4], layout, {responsive: true});
        }

        function createTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Richest counties
            richestCounties.forEach((county, index) => {
                const row = document.createElement('tr');
                row.className = 'richest';
                const usageClass = county.usage !== null && county.usage > 0.7 ? 'usage-high' : 
                                  county.usage !== null && county.usage < 0.3 ? 'usage-low' : '';
                
                row.innerHTML = `
                    <td>Richest #${index + 1}</td>
                    <td><strong>${county.name}</strong></td>
                    <td>${formatCurrency(county.income)}</td>
                    <td class="${usageClass}">${formatPercent(county.usage)}</td>
                    <td class="${usageClass}">${county.usage !== null ? (county.usage * 100).toFixed(1) + '%' : 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });

            // Poorest counties
            poorestCounties.forEach((county, index) => {
                const row = document.createElement('tr');
                row.className = 'poorest';
                const usageClass = county.usage !== null && county.usage > 0.7 ? 'usage-high' : 
                                  county.usage !== null && county.usage < 0.3 ? 'usage-low' : '';
                
                row.innerHTML = `
                    <td>Poorest #${index + 1}</td>
                    <td><strong>${county.name}</strong></td>
                    <td>${formatCurrency(county.income)}</td>
                    <td class="${usageClass}">${formatPercent(county.usage)}</td>
                    <td class="${usageClass}">${county.usage !== null ? (county.usage * 100).toFixed(1) + '%' : 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            calculateStats();
            createChart();
            createTable();
        });
    </script>
</body>
</html>

