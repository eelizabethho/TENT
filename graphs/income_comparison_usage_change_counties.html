<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Income Comparison: Top 5 vs Bottom 5 Broadband Usage Change Counties</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        #chart {
            width: 100%;
            height: 600px;
            margin-bottom: 30px;
        }
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
        }
        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
        }
        .comparison-table {
            width: 100%;
            margin-top: 30px;
            border-collapse: collapse;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .comparison-table thead {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        .comparison-table tr:hover {
            background: #f5f5f5;
        }
        .top-increase {
            background-color: #e8f5e9;
        }
        .bottom-decrease {
            background-color: #ffebee;
        }
        .section-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 10px;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Income Analysis: Broadband Usage Change Counties</h1>
        <p class="subtitle">Comparing Median Household Income for Top 5 Increases vs Bottom 5 Decreases in Broadband Usage (2019-2020)</p>
        
        <div id="chart"></div>
        
        <div class="stats-container">
            <div class="stat-card">
                <h3>Avg Income - Top 5 Increases</h3>
                <div class="value" id="avgTop5">-</div>
            </div>
            <div class="stat-card">
                <h3>Avg Income - Bottom 5 Decreases</h3>
                <div class="value" id="avgBottom5">-</div>
            </div>
            <div class="stat-card">
                <h3>Income Difference</h3>
                <div class="value" id="incomeDiff">-</div>
            </div>
            <div class="stat-card">
                <h3>State Average (2020)</h3>
                <div class="value" id="stateAvg">-</div>
            </div>
        </div>
        
        <h2 style="margin-top: 40px;">Detailed County Comparison</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>Category</th>
                    <th>County Name</th>
                    <th>Usage Change</th>
                    <th>Median Income (2020)</th>
                    <th>vs State Avg</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script>
        // Income data from va_income_2020_clean.csv
        const incomeData = {
            "Northampton": 50819,
            "Floyd": 51250,
            "Alleghany": 48513,
            "Cumberland": 50565,
            "Lunenburg": 45884,
            "Giles": 57279,
            "Augusta": 65076,
            "Roanoke": 70076,  // Using county value (city is 45664)
            "Madison": 63482,
            "Southampton": 63034
        };

        // Usage change data
        const usageChangeData = {
            // Top 5 increases
            "Northampton": { change: 265.00, usage2019: 6.00, usage2020: 21.90 },
            "Floyd": { change: 180.00, usage2019: 11.00, usage2020: 30.80 },
            "Alleghany": { change: 161.48, usage2019: 27.00, usage2020: 70.60 },
            "Cumberland": { change: 150.00, usage2019: 2.00, usage2020: 5.00 },
            "Lunenburg": { change: 148.00, usage2019: 5.00, usage2020: 12.40 },
            // Bottom 5 decreases
            "Giles": { change: -10.00, usage2019: 13.00, usage2020: 11.70 },
            "Augusta": { change: -15.31, usage2019: 32.00, usage2020: 27.10 },
            "Roanoke": { change: -24.34, usage2019: 53.00, usage2020: 40.10 },
            "Madison": { change: -26.09, usage2019: 23.00, usage2020: 17.00 },
            "Southampton": { change: -42.73, usage2019: 11.00, usage2020: 6.30 }
        };

        // Calculate state average (approximate - using all counties from income data)
        // For this visualization, we'll use a reasonable estimate or calculate from available data
        const stateAverage = 72000; // Approximate VA median household income in 2020

        const top5Counties = ["Northampton", "Floyd", "Alleghany", "Cumberland", "Lunenburg"];
        const bottom5Counties = ["Giles", "Augusta", "Roanoke", "Madison", "Southampton"];

        function formatCurrency(value) {
            return '$' + value.toLocaleString('en-US');
        }

        function calculateStats() {
            const top5Incomes = top5Counties.map(c => incomeData[c]);
            const bottom5Incomes = bottom5Counties.map(c => incomeData[c]);
            
            const avgTop5 = top5Incomes.reduce((a, b) => a + b, 0) / top5Incomes.length;
            const avgBottom5 = bottom5Incomes.reduce((a, b) => a + b, 0) / bottom5Incomes.length;
            const incomeDiff = avgBottom5 - avgTop5;
            
            document.getElementById('avgTop5').textContent = formatCurrency(avgTop5);
            document.getElementById('avgBottom5').textContent = formatCurrency(avgBottom5);
            document.getElementById('incomeDiff').textContent = formatCurrency(incomeDiff);
            document.getElementById('stateAvg').textContent = formatCurrency(stateAverage);
        }

        function createChart() {
            const top5Labels = top5Counties.map(c => c + ' County');
            const bottom5Labels = bottom5Counties.map(c => c + ' County');
            
            const top5Incomes = top5Counties.map(c => incomeData[c]);
            const bottom5Incomes = bottom5Counties.map(c => incomeData[c]);
            
            const top5UsageChanges = top5Counties.map(c => usageChangeData[c].change);
            const bottom5UsageChanges = bottom5Counties.map(c => usageChangeData[c].change);

            const trace1 = {
                x: top5Labels,
                y: top5Incomes,
                name: 'Top 5 Usage Increases',
                type: 'bar',
                marker: {
                    color: 'rgba(76, 175, 80, 0.7)',
                    line: {
                        color: 'rgba(76, 175, 80, 1)',
                        width: 2
                    }
                },
                text: top5Incomes.map(v => formatCurrency(v)),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>Income: %{text}<br>Usage Change: %{customdata:.2f}%<extra></extra>',
                customdata: top5UsageChanges
            };

            const trace2 = {
                x: bottom5Labels,
                y: bottom5Incomes,
                name: 'Bottom 5 Usage Decreases',
                type: 'bar',
                marker: {
                    color: 'rgba(244, 67, 54, 0.7)',
                    line: {
                        color: 'rgba(244, 67, 54, 1)',
                        width: 2
                    }
                },
                text: bottom5Incomes.map(v => formatCurrency(v)),
                textposition: 'outside',
                hovertemplate: '<b>%{x}</b><br>Income: %{text}<br>Usage Change: %{customdata:.2f}%<extra></extra>',
                customdata: bottom5UsageChanges
            };

            // Add state average line
            const avgLine = {
                x: [...top5Labels, ...bottom5Labels],
                y: Array(10).fill(stateAverage),
                name: 'State Average',
                type: 'scatter',
                mode: 'lines',
                line: {
                    color: 'rgba(156, 39, 176, 1)',
                    width: 2,
                    dash: 'dash'
                },
                hovertemplate: 'State Average: ' + formatCurrency(stateAverage) + '<extra></extra>'
            };

            const layout = {
                title: {
                    text: 'Median Household Income Comparison (2020)',
                    font: { size: 24 }
                },
                xaxis: {
                    title: 'County',
                    tickangle: -45,
                    tickfont: { size: 11 }
                },
                yaxis: {
                    title: 'Median Household Income ($)',
                    tickformat: '$,.0f'
                },
                barmode: 'group',
                hovermode: 'closest',
                legend: {
                    x: 0.5,
                    y: -0.3,
                    xanchor: 'center',
                    orientation: 'h'
                },
                margin: {
                    b: 150,
                    t: 100
                },
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('chart', [trace1, trace2, avgLine], layout, {responsive: true});
        }

        function createTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            // Top 5 increases
            top5Counties.forEach((county, index) => {
                const row = document.createElement('tr');
                row.className = 'top-increase';
                const income = incomeData[county];
                const usage = usageChangeData[county];
                const vsState = ((income - stateAverage) / stateAverage * 100).toFixed(1);
                const vsStateText = vsState >= 0 ? `+${vsState}%` : `${vsState}%`;
                const vsStateClass = vsState >= 0 ? 'increase' : 'decrease';
                
                row.innerHTML = `
                    <td>Top 5 Increase #${index + 1}</td>
                    <td><strong>${county} County</strong></td>
                    <td>↑ ${usage.change.toFixed(2)}%</td>
                    <td>${formatCurrency(income)}</td>
                    <td class="${vsStateClass}">${vsStateText}</td>
                `;
                tbody.appendChild(row);
            });

            // Bottom 5 decreases
            bottom5Counties.forEach((county, index) => {
                const row = document.createElement('tr');
                row.className = 'bottom-decrease';
                const income = incomeData[county];
                const usage = usageChangeData[county];
                const vsState = ((income - stateAverage) / stateAverage * 100).toFixed(1);
                const vsStateText = vsState >= 0 ? `+${vsState}%` : `${vsState}%`;
                const vsStateClass = vsState >= 0 ? 'increase' : 'decrease';
                
                row.innerHTML = `
                    <td>Bottom 5 Decrease #${index + 1}</td>
                    <td><strong>${county} County</strong></td>
                    <td>↓ ${Math.abs(usage.change).toFixed(2)}%</td>
                    <td>${formatCurrency(income)}</td>
                    <td class="${vsStateClass}">${vsStateText}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            calculateStats();
            createChart();
            createTable();
        });
    </script>
</body>
</html>


